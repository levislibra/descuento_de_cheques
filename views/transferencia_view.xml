<?xml version="1.0"?>
<openerp>
    <data>

    <!-- formulario Intereses - Formulario de creacion -->

    <record id="transferencia_tree" model="ir.ui.view">
        <field name="name">transferencia.tree</field>
        <field name="model">transferencia</field>
        <field name="arch" type="xml">
            <tree string="Pagos y Cobros">
                <field name="fecha"/>
                <field name="tipo_de_pago"/>
                <field name="cuenta_entidad_id"/>
                <field name="state"/>
            </tree>
        </field>
    </record>

    <record id="transferencia_form" model="ir.ui.view">
        <field name="name">transferencia.form</field>
        <field name="model">transferencia</field>
        <field name="arch" type="xml">
            <form string="Pago o Cobro" editable="bottom">
                <header>
                    <button name="confirmar" string="Confirmar" states="borrador" type="object"/>
                    <button name="registrar" string="Regisrar" states="confirmada"  type="object"/>
                    <button name="cancelar" string="Cancelar" states="confirmada" type="object"/>
                    <button name="editar" string="Editar" type="object"/>
                    <field name="state"  widget="statusbar"/>
                </header>
                <sheet col="4">
                    <group>
                        <field name="fecha" attrs="{'readonly': [('state', '!=', 'borrador')]}"/>

                        <field name="tipo_de_pago" attrs="{'readonly': [('state', '!=', 'borrador')]}"/>

                        <field name="journal_transferencia_id" attrs="{'invisible': [('tipo_de_pago', 'in', ('recibirDinero', 'enviarDinero'))], 'readonly': [('state', '!=', 'borrador')], 'required': [('tipo_de_pago', 'in', ('transferenciaContable', 'transferenciaEntidad'))]}"/>

                        <field name="deposito_bancario" attrs="{'invisible': [('tipo_de_pago', '!=', 'enviarDinero')], 'readonly': [('state', '!=', 'borrador')]}"/>
                    </group>

                    <group>
                        <field name="cuenta_entidad_id" attrs="{'invisible': ['|', ('tipo_de_pago', '=', 'transferenciaContable'), ('deposito_bancario', '=', True)], 'required': [('tipo_de_pago', '!=', 'transferenciaContable'), ('deposito_bancario', '=', False)], 'readonly': [('state', '!=', 'borrador')]}"/>

                        <field name="subcuenta_id" domain="[('cuenta_entidad_id.id','=', cuenta_entidad_id)]" attrs="{'invisible': ['|', ('tipo_de_pago', '=', 'transferenciaContable'), ('deposito_bancario', '=', True)], 'required': [('tipo_de_pago', '!=', 'transferenciaContable'), ('deposito_bancario', '=', False)], 'readonly': [('state', '!=', 'borrador')]}"/>
                    </group>

                    <group>
                        <field name="cuenta_entidad2_id" attrs="{'invisible': [('tipo_de_pago', '!=', 'transferenciaEntidad')], 'required': [('tipo_de_pago', '=', 'transferenciaEntidad')], 'readonly': [('state', '!=', 'borrador')]}"/>

                        <field name="subcuenta2_id" domain="[('cuenta_entidad_id.id','=', cuenta_entidad2_id)]" attrs="{'invisible': [('tipo_de_pago', '!=', 'transferenciaEntidad')], 'required': [('tipo_de_pago', '=', 'transferenciaEntidad')], 'readonly': [('state', '!=', 'borrador')]}"/>
                    </group>

                    <group>
                        <field name="cuenta_id" attrs="{'invisible': [('tipo_de_pago', '!=', 'transferenciaContable'), ('deposito_bancario', '=', False)], 'required': ['|', ('tipo_de_pago', '=', 'transferenciaContable'), ('deposito_bancario', '=', True)], 'readonly': [('state', '!=', 'borrador')]}"/>

                        <field name="cuenta2_id" attrs="{'invisible': [('tipo_de_pago', '!=', 'transferenciaContable')], 'required': [('tipo_de_pago', '=', 'transferenciaContable')], 'readonly': [('state', '!=', 'borrador')]}"/>
                    </group>
                    <group>
                        <field name="monto"  attrs="{'readonly': [('state', '!=', 'borrador')], 'invisible': ['|', ('tipo_de_pago', '=', 'recibirDinero'), ('tipo_de_pago', '=', 'enviarDinero')]}"/>

                        <field name="efectivo" attrs="{'readonly': [('state', '!=', 'borrador')], 'invisible': ['|', ('tipo_de_pago', '=', 'transferenciaContable'), ('tipo_de_pago', '=', 'transferenciaEntidad')]}" />

                        <field name="journal_id" attrs="{'readonly': [('state', '!=', 'borrador')], 'invisible': [('efectivo', '=', False)], 'required': [('efectivo', '=', True)]}"/>

                        <field name="monto_efectivo"  attrs="{'readonly': [('state', '!=', 'borrador')], 'invisible': [('efectivo', '=', False)]}"/>

                        <field name="cheques" attrs="{'readonly': [('state', '!=', 'borrador')], 'invisible': ['|', ('tipo_de_pago', '=', 'transferenciaContable'), ('tipo_de_pago', '=', 'transferenciaEntidad')]}" />
                        
                        <field name="enviar_cheques_ids" domain="[('state','=', 'en_cartera')]" widget="many2many_tags" options="{'no_create': True}" attrs="{'readonly': [('state', '!=', 'borrador')], 'invisible': ['|', ('cheques', '=', False), ('tipo_de_pago', '!=', 'enviarDinero')]}">
                            <tree string="Cheques" delete="false">
                                <field name="name"/>
                                <field name="firmante_id"/>
                                <field name="banco_id"/>
                                <field name="importe" sum="Total"/>
                                <field name="fecha_vencimiento"/>
                            </tree>
                            <form>
                                <group readonly='1'>
                                    <field name="name"/>
                                    <field name="firmante_id"/>
                                    <field name="banco_id"/>
                                    <field name="importe"/>
                                    <field name="fecha_vencimiento"/>
                                </group>
                            </form>
                        </field>

                        <field name="journal_recibir_cheques_id" attrs="{'readonly': [('state', '!=', 'borrador')], 'invisible': ['|', ('cheques', '=', False), ('tipo_de_pago', '!=', 'recibirDinero')]}"/>

                        <field name="recibir_cheques_ids" attrs="{'readonly': [('state', '!=', 'borrador')], 'invisible': ['|', ('cheques', '=', False), ('tipo_de_pago', '!=', 'recibirDinero')]}">
                            <tree string="Cheques" editable="bottom" >
                                <field name="name"/>
                                <field name="firmante_id"/>
                                <field name="banco_id"/>
                                <field name="importe" sum="Total"/>
                                <field name="fecha_vencimiento"/>
                            </tree>
                        </field>

                        <field name="gastos" attrs="{'readonly': [('state', '!=', 'borrador')], 'invisible': [('tipo_de_pago', '!=', 'enviarDinero')]}" />

                        <field name="monto_gasto" attrs="{'readonly': [('state', '!=', 'borrador')], 'invisible': [('gastos', '=', False)]}" />

                        <field name="porcentaje_gasto" attrs="{'readonly': [('state', '!=', 'borrador')], 'invisible': [('gastos', '=', False)]}" />

                        <field name="cuenta_gastos_id" attrs="{'readonly': [('state', '!=', 'borrador')], 'invisible': [('gastos', '=', False)], 'required': [('gastos', '=', True)]}" />
                    </group>
                    <notebook>
                        <page name="apuntes" string="Apuntes">
                            <group>
                                <field name="move_id" readonly="1" />
                                <field name="state_move_id" readonly="1" />
                            </group>
                            <field name="move_line_ids">
                                <tree name="movimientos">
                                    <field name="date"/>
                                    <field name="partner_id"/>
                                    <field name="account_id"/>
                                    <field name="name"/>
                                    <field name="amount_currency"/>
                                    <field name="currency_id"/>
                                    <field name="debit" sum="Total"/>
                                    <field name="credit" sum="Total"/>
                                    <field name="move_id"/>
                                    <field name="journal_id"/>
                                </tree>
                            </field>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <record id="transferencia_action" model="ir.actions.act_window">
        <field name="name">transferencia</field>
        <field name="res_model">transferencia</field>
        <field name="view_mode">tree,form</field>
        <field name="view_id" ref="transferencia_tree"/>
    </record>

    <menuitem id="smenu_generales_transferencias" name="Pagos/Cobros/Depositos/Transferencia" parent="smenu_generales" action="transferencia_action" sequence="0" />

    </data>
</openerp>
